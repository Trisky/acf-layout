"use strict";(function(a){var b=function(){return a(".acf-fc-popup")},c=function(){return b().filter(":visible:last")},d=function(b){var c=[],d=a("<div class=\"offbeat-acf-component-search\"><ul></ul></div>").hide(),e=a("<div class=\"offbeat-acf-current-context offbeat-acf-component-list groups\">"),f=a("<ul>");b.append(d);var g=/^([^(]+)\((.+?)\)$/gm;b.find("li a",b).each(function(b,d){var e,f,h=a(d).text(),i=g.exec(h);g.lastIndex=0,i?(e=i[1],f=i[2]):(e=h,f="General");var j=a(d).closest("li");a(d).text(e),c[f]||(c[f]=[]),c[f].push(j.clone())});var h=Object.keys(c);return 1>=h.length?void b.find(">ul").wrap(e.removeClass("groups")):void(h.sort(function(c,a){var b=c[1].toLowerCase(),d=a[1].toLowerCase();return b<d?-1:b>d?1:0}),h.forEach(function(b){var d=a("<li><span>".concat(b,"</span><ul style=\"display:none\"></ul></li>")).appendTo(f).find("ul");c[b].forEach(function(a){d.append(a)})}),f.prependTo(b).wrap(e),b.find(">ul").remove())},f=function(b){var c=function(){return b.find(".offbeat-acf-current-context")},d=function(b){if(b&&a(b).is("li"))return a(b);var d=a("li.active li.active",c());return d.length||(d=a("li.active",c())),d.length?d:void 0};b.on("click","li",function(b){var d=a(b.target).is("li")?a(b.target):a(b.target).closest("li");d.is(a(">ul>li",c()))&&d.trigger("offbeat.group.click")}).on("offbeat.group.click",function(b){var e=d(b.target);e&&(a(">a",e).length?a(">a",e).trigger("click"):e.is(a(">ul>li",c()))&&(e.find(">ul").is(":visible")?e.trigger("offbeat.close"):e.trigger("offbeat.open")))}).on("offbeat.group.open",function(b){var e=d(b.target);e&&(e.is(a(">ul>li",c()))?(e.siblings().trigger("offbeat.group.close"),e.trigger("offbeat.item.active"),e.find(">ul").show(),e.find(">ul>li:first").trigger("offbeat.item.active")):e.is(a(">ul>li>ul>li",c()))&&e.closest("ul").show())}).on("offbeat.group.close",function(b){var e=d(b.target);e&&(e.is(a(">ul>li",c()))?e.find(">ul").hide():e.is(a(">ul>li>ul>li",c()))&&(e.closest("ul").hide(),e.trigger("offbeat.item.inactive")))}).on("offbeat.item.active",function(b){a(b.target).is(a("li",c()))&&(a(b.target).trigger("offbeat.inactive"),a(b.target).addClass("active"))}).on("offbeat.item.inactive",function(b){a(b.target).is(a("li",c()))&&a(b.target).siblings("li").addBack().removeClass("active")}).on("offbeat.item.next",function(){var a=d();if(a){var b=a.nextAll(":visible").first();b.length||(b=a.siblings(":visible").first()),b.length&&b.trigger("offbeat.item.active")}}).on("offbeat.item.prev",function(){var a=d();if(a){var b=a.prevAll(":visible").first();b.length||(b=a.siblings(":visible").last()),b.length&&b.trigger("offbeat.item.active")}}).on("offbeat.search",function(c,d){var e=new RegExp(d,"i"),f=b.find(".offbeat-acf-component-list"),g=b.find(".offbeat-acf-component-search");if(d){f.removeClass("offbeat-acf-current-context").hide();var h=a("ul",g);h.empty();var i=[],j=f.hasClass("groups")?">ul>li>ul>li":">ul>li";a(j,f).each(function(b,c){var d=a(c);e.test(a(d).text())&&i.push([a(d).clone(!0),a(d).text()])}),i.sort(function(c,a){var b=c[1].toLowerCase(),d=a[1].toLowerCase();return b<d?-1:b>d?1:0}).forEach(function(a){h.append(a[0])}),g.addClass("offbeat-acf-current-context").show(),a(">ul>li:first",g).trigger("offbeat.item.active")}else f.addClass("offbeat-acf-current-context").show(),g.removeClass("offbeat-acf-current-context").hide()}),a(">ul>li:first",c()).trigger("offbeat.item.active").trigger("offbeat.group.open");var e=a("input[type=\"text\"]",b);e.length||(e=a("<input type=\"text\" placeholder=\"Search component\" />"),e.on("keyup",function(c){13===c.keyCode?b.trigger("offbeat.group.click"):0<=a.inArray(c.keyCode,[37,39])?37===c.keyCode?b.trigger("offbeat.group.close"):39===c.keyCode&&b.trigger("offbeat.group.open"):-1===a.inArray(c.keyCode,[38,40])&&b.trigger("offbeat.search",[a(c.target).val()])}).on("keydown",function(c){38===c.keyCode?a(b).trigger("offbeat.item.prev"):40===c.keyCode&&a(b).trigger("offbeat.item.next")}),b.prepend(e)),e.trigger("focus")};a(document).ready(function(){a("body").on("click",".acf-fc-popup",function(b){return a(b.currentTarget).find(":text").trigger("focus"),!1}),a(document).on("click","a[data-name=\"add-layout\"]",function(b){d(c()),f(c());var e=parseInt(a(b.currentTarget).offset().top),g=function(a){a.hasClass("top")&&a.css("top",e-parseInt(a.outerHeight()))};g(c()),c().on("offbeat.search",function(){g(c())})})})})(jQuery);