(e=>{const t=()=>(()=>e(".acf-fc-popup"))().filter(":visible:last");e(document).ready(()=>{e("body").on("click",".acf-fc-popup",t=>(e(t.currentTarget).find(":text").trigger("focus"),!1)),e(document).on("click",'a[data-name="add-component"]',a=>{(t=>{const a=[],i=e('<div class="offbeat-acf-component-search"><ul></ul></div>').hide(),n=e('<div class="offbeat-acf-current-context offbeat-acf-component-list groups">'),o=e("<ul>");t.append(i),t.find("li a",t).each((t,i)=>{const n=e(i).text();let o=e(i).data("category");o||(o="General");const c=e(i).closest("li");e(i).text(n),a[o]||(a[o]=[]),a[o].push(c.clone())});let c=Object.keys(a);c.length<=1?t.find(">ul").wrap(n.removeClass("groups")):(c.sort((e,t)=>{const a=e[1].toLowerCase(),i=t[1].toLowerCase();return a<i?-1:a>i?1:0}),c.forEach(t=>{const i=e(`<li><span>${t}</span><ul style="display:none"></ul></li>`).appendTo(o).find("ul");a[t].forEach(e=>{i.append(e)})}),o.prependTo(t).wrap(n),t.find(">ul").remove())})(t()),(t=>{const a=()=>t.find(".offbeat-acf-current-context"),i=t=>{if(t&&e(t).is("li"))return e(t);let i=e("li.active li.active",a());return i.length||(i=e("li.active",a())),i.length?i:void 0};t.on("click","li",t=>{const i=e(t.target).is("li")?e(t.target):e(t.target).closest("li");i.is(e(">ul>li",a()))&&i.trigger("offbeat.group.click")}).on("offbeat.group.click",t=>{const n=i(t.target);n&&(e(">a",n).length?e(">a",n).trigger("click"):n.is(e(">ul>li",a()))&&(n.find(">ul").is(":visible")?n.trigger("offbeat.close"):n.trigger("offbeat.open")))}).on("offbeat.group.open",t=>{const n=i(t.target);n&&(n.is(e(">ul>li",a()))?(n.siblings().trigger("offbeat.group.close"),n.trigger("offbeat.item.active"),n.find(">ul").show(),n.find(">ul>li:first").trigger("offbeat.item.active")):n.is(e(">ul>li>ul>li",a()))&&n.closest("ul").show())}).on("offbeat.group.close",t=>{const n=i(t.target);n&&(n.is(e(">ul>li",a()))?n.find(">ul").hide():n.is(e(">ul>li>ul>li",a()))&&(n.closest("ul").hide(),n.trigger("offbeat.item.inactive")))}).on("offbeat.item.active",t=>{e(t.target).is(e("li",a()))&&(e(t.target).trigger("offbeat.inactive"),e(t.target).addClass("active"))}).on("offbeat.item.inactive",t=>{e(t.target).is(e("li",a()))&&e(t.target).siblings("li").addBack().removeClass("active")}).on("offbeat.item.next",()=>{const e=i();if(!e)return;let t=e.nextAll(":visible").first();t.length||(t=e.siblings(":visible").first()),t.length&&t.trigger("offbeat.item.active")}).on("offbeat.item.prev",()=>{const e=i();if(!e)return;let t=e.prevAll(":visible").first();t.length||(t=e.siblings(":visible").last()),t.length&&t.trigger("offbeat.item.active")}).on("offbeat.search",(a,i)=>{const n=new RegExp(i,"i"),o=t.find(".offbeat-acf-component-list"),c=t.find(".offbeat-acf-component-search");if(i){o.removeClass("offbeat-acf-current-context").hide();const t=e("ul",c);t.empty();const a=[],i=o.hasClass("groups")?">ul>li>ul>li":">ul>li";e(i,o).each((t,i)=>{const o=e(i);n.test(e(o).text())&&a.push([e(o).clone(!0),e(o).text()])}),a.sort((e,t)=>{const a=e[1].toLowerCase(),i=t[1].toLowerCase();return a<i?-1:a>i?1:0}).forEach(e=>{t.append(e[0])}),c.addClass("offbeat-acf-current-context").show(),e(">ul>li:first",c).trigger("offbeat.item.active")}else o.addClass("offbeat-acf-current-context").show(),c.removeClass("offbeat-acf-current-context").hide()}),e(">ul>li:first",a()).trigger("offbeat.item.active").trigger("offbeat.group.open");let n=e('input[type="text"]',t);n.length||((n=e('<input type="text" placeholder="Search component" />')).on("keyup",a=>{13===a.keyCode?t.trigger("offbeat.group.click"):e.inArray(a.keyCode,[37,39])>=0?37===a.keyCode?t.trigger("offbeat.group.close"):39===a.keyCode&&t.trigger("offbeat.group.open"):-1===e.inArray(a.keyCode,[38,40])&&t.trigger("offbeat.search",[e(a.target).val()])}).on("keydown",a=>{38===a.keyCode?e(t).trigger("offbeat.item.prev"):40===a.keyCode&&e(t).trigger("offbeat.item.next")}),t.prepend(n)),n.trigger("focus")})(t());const i=parseInt(e(a.currentTarget).offset().top),n=e=>{e.hasClass("top")&&e.css("top",i-parseInt(e.outerHeight()))};n(t()),t().on("offbeat.search",()=>{n(t())})})});!function(){if("undefined"!=typeof acf){var t=acf.getFieldType("offbeat_components").prototype;t.events["click [data-acfe-flexible-control-clone]"]="acfeCloneComponent",t.acfeCloneComponent=function(t,a){var i,n=a.closest(".layout"),o=n.data("layout"),c=e(this.$popup().html()),r=this.$layouts(),f=c.find('[data-layout="'+o+'"]'),s=(f.data("min"),f.data("max")||0),l=(i=o,r.filter(function(){return e(this).data("layout")===i}).length);if(s&&l>=s)return a.addClass("disabled"),!1;a.removeClass("disabled"),this.acfeFixInputs(n);var d=n.clone();this.acfeCleanLayouts(d);var p=a.closest(".acf-flexible-content").find("> input[type=hidden]").attr("name");this.acfeDuplicate({layout:d,before:n,parent:p})},t.acfeDuplicate=function(e){if(e=acf.parseArgs(e,{layout:"",before:!1,parent:!1,search:"",replace:""}),!this.allowAdd())return!1;var t=acf.uniqid();e.parent&&(e.search||(e.search=e.parent+"["+e.layout.attr("data-id")+"]"),e.replace=e.parent+"["+t+"]");var a=acf.duplicate({target:e.layout,search:e.search,replace:e.replace,append:this.proxy(function(a,i){i.addClass("acfe-layout-duplicated"),i.attr("data-id",t),e.before?e.before.after(i):this.$layoutsWrap().append(i),acf.enable(i,this.cid),this.render()})});return this.$input().trigger("change"),a},t.acfeFixInputs=function(t){t.find("input").each(function(){e(this).attr("value",this.value)}),t.find("textarea").each(function(){e(this).html(this.value)}),t.find("input:radio,input:checkbox").each(function(){this.checked?e(this).attr("checked","checked"):e(this).attr("checked",!1)}),t.find("option").each(function(){this.selected?e(this).attr("selected","selected"):e(this).attr("selected",!1)})},t.acfeCleanLayouts=function(t){t.find(".acf-editor-wrap").each(function(){var t=e(this);t.find(".wp-editor-container div").remove(),t.find(".wp-editor-container textarea").css("display","")}),t.find(".acf-date-picker").each(function(){e(this).find("input.input").removeClass("hasDatepicker").removeAttr("id")}),t.find(".acf-time-picker").each(function(){e(this).find("input.input").removeClass("hasDatepicker").removeAttr("id")}),t.find(".acf-date-time-picker").each(function(){e(this).find("input.input").removeClass("hasDatepicker").removeAttr("id")}),t.find(".acf-color-picker").each(function(){var t=e(this),a=t.find("> input"),i=t.find(".wp-picker-container input.wp-color-picker").clone();a.after(i),t.find(".wp-picker-container").remove()}),t.find(".acf-field-post-object").each(function(){var t=e(this);t.find("> .acf-input span").remove(),t.find("> .acf-input select").removeAttr("tabindex aria-hidden").removeClass()}),t.find(".acf-field-page-link").each(function(){var t=e(this);t.find("> .acf-input span").remove(),t.find("> .acf-input select").removeAttr("tabindex aria-hidden").removeClass()}),t.find(".acf-field-select").each(function(){var t=e(this);t.find("> .acf-input span").remove(),t.find("> .acf-input select").removeAttr("tabindex aria-hidden").removeClass()}),t.find(".acf-field-font-awesome").each(function(){var t=e(this);t.find("> .acf-input span").remove(),t.find("> .acf-input select").removeAttr("tabindex aria-hidden")}),t.find(".acf-tab-wrap").each(function(){var t=e(this),a=t.closest(".acf-fields"),i=[];e.each(t.find("li a"),function(){i.push(e(this))}),a.find("> .acf-field-tab").each(function(){$current_tab=e(this),e.each(i,function(){var t=e(this);t.attr("data-key")==$current_tab.attr("data-key")&&$current_tab.find("> .acf-input").append(t)})}),t.remove()}),t.find(".acf-field-accordion").each(function(){var t=e(this);t.find("> .acf-accordion-title > .acf-accordion-icon").remove(),t.after('<div class="acf-field acf-field-accordion" data-type="accordion"><div class="acf-input"><div class="acf-fields" data-endpoint="1"></div></div></div>')})},acf.addAction("new_field/type=offbeat_components",function(t){t.$layouts().each(function(){a(e(this))})}),acf.add_action("append",function(t){e(t).has(".component")&&a(e(t))})}function a(e){var t=e.find("> .acf-fc-layout-controls");t.has("[data-acfe-flexible-control-clone]").length||t.prepend('<a class="acf-icon small light acf-js-tooltip acfe-flexible-icon dashicons dashicons-admin-page" href="#" title="Clone component" data-acfe-flexible-control-clone="'+e.attr("data-component")+'"></a>')}}()})(jQuery);